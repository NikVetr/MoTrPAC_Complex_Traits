# The impact of exercise on gene regulation in association with complex trait genetics

This is the GitHub repository associated with the publication: [insert publication link and citation here] 

>**If this line is still here, it's still a WiP, so apologies for any missing components!**

It primarily hosts scripts written in the R programming language that were used to 
generate all of the paper figures. The names of these scripts are given in figure order, 
i.e. `fig*_`. Software and data dependencies are listed below. Data dependencies are 
also provided in the `/data` folder where possible.

Additionally, this GitHub plays host to several supplementary figures, datasets, 
MCMC output, and other files generated by these scripts.

In the interests of reproducibility, we've endeavored for these scripts function as end-to-end pipelines, capable of taking users from public data downloads to final figures and paper, at least on the assumption that all dependencies 
have been properly installed. That said, just because everything runs on my machine (16" 2019 MBP, macOS 10.15.7) does not mean they'll run seamlessly on yours, at least if you're reading this before I've had the chance to dockerize everything. 
Please contact me at nikgvetr@stanford.edu if you encounter difficulties and I'll do me best to help.

GitHub is also limited in how much storage can be devoted to each repository, but the total filesize of all files used in this paper clocks in at >0.5TB. To download these files, I've separated /data/internal from /data/external, and provide a script (scripts/download_external_files.R) to help users acquire the latter, either from my own Zenodo repos or, where possible, from their original sources.

## Dependencies

### R (4.0.4) packages used in these scripts include:

* fgsea: 1.16.0
* Cairo: 1.5.15
* DESeq2: 1.30.1
* EnsDb.Hsapiens.v79: 2.99.0
* EnsDb.Hsapiens.v86: 2.99.0
* MASS: 7.3.57
* MotrpacRatTraining6mo: 1.6.4
* MotrpacRatTraining6moData: 1.9.1
* arrow: 8.0.0
* biomaRt: 2.46.3
* caret: 6.0.92
* circlize: 0.4.15
* clusterProfiler: 3.18.1
* cmdstanr: 0.3.0.9000
* data.table: 1.14.8
* doParallel: 1.0.17
* dplyr: 1.1.2
* edgeR: 3.32.1
* ensembldb: 2.14.1
* fitdistrplus: 1.1.8
* foreach: 1.5.2
* ggplot2: 3.4.2
* invgamma: 1.1
* jpeg: 0.1.9
* jsonlite: 1.8.4
* ks: 1.13.5
* limma: 3.46.0
* org.Hs.eg.db: 3.12.0
* org.Rn.eg.db: 3.12.0
* parallel: 4.0.4
* plotrix: 3.8.2
* posterior: 1.2.2
* pracma: 2.3.8
* sparklyr: 1.7.7
* sparklyr.nested: 0.0.3
* testit: 0.13
* xlsx: 0.6.5

### alongside external software and command-line tools

* [plink2](https://www.cog-genomics.org/plink/2.0/) (2.00a3)
* [GCTA](https://yanglab.westlake.edu.cn/software/gcta/#Overview) (1.93.2)
* [MESC](https://github.com/douglasyao/mesc)  
* [LDSC](https://github.com/bulik/ldsc) (1.0.1)
* [Stan](https://mc-stan.org/) (2.21.0)

Please follow the installation instructions at the above links to install these packages.

### Datasets  

The following paths, files, and R data objects are used within these scripts. Here
we provide documentation on their sources. When possible, these datasets are also
included in `/data`. 

* `/data/external/gtex-pipeline/expression_genotypes/GTEx_v8_noChr_noRSID.bim`:  
* `/data/external/gtex-pipeline/GTEx_Analysis_v8_eQTL_covariates/`:  
* `/data/external/gtex-pipeline/GTEx_Analysis_v8_eQTL_expression_matrices/`:  
* `/data/external/gtex-pipeline/log2-normalized-expression/log2-normalized-expression_*.expression.bed.gz`:  
* `data/external/41467_2021_23579_MOESM6_ESM.csv`: [Dataset 5](https://static-content.springer.com/esm/art%3A10.1038%2Fs41467-021-23579-x/MediaObjects/41467_2021_23579_MOESM6_ESM.xlsx)
from the human exercise meta-analysis by Amar et al.: <https://pubmed.ncbi.nlm.nih.gov/34108459/> 
* `data/external/eqtl/spredixcan_igwas_gtexmashrv8_*`: Barbeira et al. `S-PrediXcan` results
available [here](https://zenodo.org/record/3518299#.Y9rPqezMIUE), provided as a 
supplement to their manuscript: <https://pubmed.ncbi.nlm.nih.gov/33499903/>   
* `data/external/est_gcor_mat.RData`:  
* `data/external/GENES_HUMAN.txt`:  
* `data/external/GENES_RAT.txt`:  
* `data/external/GTEx_Analysis_v8_sbgenes/signif.sbgenes.txt`:  
* `data/external/GTEx_v8_ExpressionScores/tissues/`:  
* `data/external/gwas_metadata.csv`:  
* `data/external/imputed_gwas_hg38_1.1/`: GWAS imputed and harmonized for colocalization 
analysis with GTEx v8. Provided [here](https://zenodo.org/record/3629742#.Y9rTQOzMIUF) by Barbeira et al. as a supplement to their 
manuscript: <https://pubmed.ncbi.nlm.nih.gov/33499903/>  
* `data/external/meta_analysis_results.RData`:  
* `data/external/old_dea_deseq_20201121/*_training-dea_20201121.RData`:  
* `data/external/open-targets_tissue-x-disease_*`:  
* `data/external/opentargets/associationByOverallDirect.csv`:  
* `data/external/opentargets/associationByOverallIndirect.csv`:  
* `data/external/PANTHER17_human_rat_ref_genome_orthologs.tsv`:  
* `data/external/relative_expression_motrpac_gtex`:  
* `data/external/RGD_ORTHOLOGS_20201001.txt`: Data downloaded from RGD FTP website 
on 10/01/2020 by Pierre Jean (<ftp://ftp.rgd.mcw.edu/pub/data_release/orthologs/>). 

This file contain mapping between rat, human, and mouse primarily through NCBI gene IDs.  
* `data/external/RSID_POS_MAP_*.txt`:  
* `data/external/zcor_transcriptome_pass1b.tsv`:  
* `data/external/ldsc/1000G_EUR_Phase3_plink/1000G.EUR.QC.*.bim`:  
* `data/external/ldsc/baseline/baseline.*.annot`:  
* `data/external/ldsc/custom_genesets/cluster_*.chr_*.annot`: 
* `data/external/ldsc/ENSG_coord.txt`:  
